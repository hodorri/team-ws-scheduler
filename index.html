<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>2025년 팀 단위 조직개발 W/S 스케줄러</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Spoqa+Han+Sans+Neo&display=swap" rel="stylesheet">
  <style>
    /* 폰트 정의 */
    @font-face { font-family: 'OKFont'; src: url('OKFont-Bold.woff') format('woff'); font-weight: 700; }
    @font-face { font-family: 'OKFont'; src: url('OKFont-Medium.woff') format('woff'); font-weight: 500; }
    @font-face { font-family: 'OKFont'; src: url('OKFont-Light.woff') format('woff'); font-weight: 300; }
    @font-face { font-family: 'OKFont'; src: url('오케이체 Light.ttf') format('truetype'); font-weight: 300; }

    body { font-family: 'OKFont', sans-serif; background: #fff8f0; color: #333; padding: 30px; }
    h1 { font-size: 36px; color: #F55000; margin-bottom: 8px; }
    .form-section label { display: block; margin: 15px 0 5px; font-size: 18px; font-weight: 500; }
    select, input, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; font: 300 12px 'OKFont'; }
    input::placeholder, textarea::placeholder { color: #aaa; }
    .form-section { margin-bottom: 20px; }
    button { background: #FFAA00; color: #fff; padding: 12px 20px; font-size: 16px; border: none; border-radius: 10px; cursor: pointer; }
    button:hover { background: #554700; }

    /* 캘린더 스타일 */
    .calendar-container { margin: 20px 0; border: 1px solid #ccc; border-radius: 8px; overflow: hidden; }
    .calendar-header { background: #554700; color: #fff; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
    .month-title { font-size: 18px; font-weight: bold; }
    .legend .dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin: 0 4px; }
    .legend .available { background: #F55000; }
    .legend .disabled { background: #ccc; }
    .calendar-weekdays { display: grid; grid-template-columns: repeat(5, 1fr); background: #f0f0f0; text-align: center; }
    .calendar-weekdays div { padding: 6px 0; font-weight: 500; }
    .calendar-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 2px; }
    .calendar-cell { border: 1px solid #ddd; min-height: 100px; padding: 4px; position: relative; }
    .date-num { font-size: 12px; font-weight: bold; position: absolute; top: 4px; right: 4px; }
    .time-slots { margin-top: 20px; display: flex; flex-direction: column; gap: 2px; }
    .time-slot { font-size: 12px; padding: 4px; border: 1px solid #aaa; border-radius: 4px; cursor: pointer; text-align: center; }
    .time-slot.disabled { opacity: 0.4; cursor: not-allowed; }
    .time-slot.selected { background: #F55000; color: #fff; border-color: #F55000; }

    /* 신청 현황 스타일 */
    #bookingList { margin: 20px 0; }
    .booking-card { background: #fff; border: 1px solid #ddd; border-radius: 6px; padding: 12px; margin-bottom: 8px; }
    .booking-header { font-weight: bold; color: #554700; margin-bottom: 6px; }
    .booking-info { display: flex; gap: 12px; font-size: 12px; color: #555; }
  </style>
</head>
<body>
  <h1>2025년 팀 단위 조직개발 W/S 스케줄러🕐</h1>
  <p style="font:300 12px 'OKFont';">5/19(월)~5/30(금) 09:00~18:00 중 가능한 시간대로 신청하세요. 이미 예약된 블록은 회색으로 표시됩니다.</p>

  <form id="scheduleForm">
    <div class="form-section">
      <label for="team">팀 선택</label>
      <select id="team" name="team" required>
        <option value="">-- 팀 선택 --</option>
        <option>검사팀</option><option>대전중앙지점</option><option>수신팀</option><option>안산지점</option>
        <option>여신감리팀</option><option>플랫폼기획팀</option><option>보안기획팀</option><option>인프라서비스1팀</option>
        <option>인재개발팀</option><option>재무회계팀</option><option>전략기획팀</option>
      </select>
    </div>
    <div class="form-section">
      <label for="datetime">팀 워크숍 일정 선택</label>
      <div class="calendar-container">
        <div class="calendar-header">
          <span class="month-title">2025년 5월</span>
          <div class="legend"><span class="dot available"></span>선택 가능<span class="dot disabled"></span>불가</div>
        </div>
        <div class="calendar-weekdays">
          <div>월</div><div>화</div><div>수</div><div>목</div><div>금</div>
        </div>
        <div id="calendarGrid" class="calendar-grid"></div>
      </div>
      <input type="text" id="datetime" name="datetime" readonly placeholder="YYYY-MM-DD HH:00 ~ HH:00" required>
    </div>
    <button type="submit">신청하기</button>
  </form>

  <div id="bookingList"><h3 class="booking-header">신청 현황</h3><div id="bookingCards"></div></div>

  <script>
  (async()=>{
    const URL = 'https://script.google.com/macros/s/AKfycbwCYXoZV6Tpv4E8SvHLlDMpvjlHTNDsNiX8AEq2nGJkkRk-QDgZvUCMLT6zKMuJzltX/exec';
    const grid = document.getElementById('calendarGrid');
    const input = document.getElementById('datetime');
    const cards = document.getElementById('bookingCards');

    // 데이터 로드
    async function loadData() {
      try {
        const res = await fetch(URL);
        return await res.json();
      } catch {
        return [];
      }
    }

    // 렌더링
    async function render() {
      const bookings = await loadData();

      // 신청 현황 카드
      cards.innerHTML = '';
      if (bookings.length) {
        bookings.sort((a,b)=>a.datetime.localeCompare(b.datetime));
        bookings.forEach(b=>{
          const card = document.createElement('div'); card.className='booking-card';
          card.innerHTML = `<div class="booking-header">${b.team}</div><div class="booking-info"><span>${b.datetime}</span><span>${b.name}</span></div>`;
          cards.appendChild(card);
        });
      } else {
        cards.innerHTML = '<p>아직 신청된 일정이 없습니다.</p>';
      }

      // 캘린더 초기화
      grid.innerHTML = '';
      const timeSlots = ['09:00','10:00','11:00','12:00','13:00','14:00','15:00'];

      // 5/19~5/30, 평일만
      for (let d = 19; d <= 30; d++) {
        const date = new Date(2025,4,d);
        const dow = date.getDay();
        if (dow === 0 || dow === 6) continue;

        const cell = document.createElement('div'); cell.className='calendar-cell';
        const num = document.createElement('div'); num.className='date-num'; num.textContent=d; cell.appendChild(num);

        const wrap = document.createElement('div'); wrap.className='time-slots';
        timeSlots.forEach(t=>{
          const btn = document.createElement('span'); btn.className='time-slot'; btn.textContent=t;
          // 신청 블록 비활성화 (3시간 범위)
          const blk = bookings.some(b=>{
            const [ds, _, rng] = b.datetime.split(' ');
            if (!ds.endsWith(String(d).padStart(2,'0'))) return false;
            const [st, , et] = rng.split(' ');
            const sh = parseInt(st);
            const eh = parseInt(et);
            const th = parseInt(t);
            return th >= sh && th < eh;
          });
          if (blk) btn.classList.add('disabled'); else {
            btn.addEventListener('click', ()=>{
              wrap.querySelectorAll('.time-slot').forEach(s=>s.classList.remove('selected'));
              const slots = Array.from(wrap.children);
              const idx = slots.indexOf(btn);
              slots.slice(idx, idx+3).forEach(s=>s.classList.add('selected'));
              const start = btn.textContent;
              const end = String(parseInt(start)+3).padStart(2,'0')+':00';
              input.value = `2025-05-${String(d).padStart(2,'0')} ${start} ~ ${end}`;
            });
          }
          wrap.appendChild(btn);
        });
        cell.appendChild(wrap);
        grid.appendChild(cell);
      }
    }

    document.getElementById('scheduleForm').addEventListener('submit',async function(e){
      e.preventDefault();
      await fetch(URL, {method:'POST', body:new FormData(this)});
      this.reset();
      await render();
      alert('신청이 완료되었습니다!');
    });

    await render();
    setInterval(render,30000);
  })();
  </script>
</body>
</html>
